---
title: "语言无关的Web框架的构思"
date: 2020-03-29T12:15:55+08:00
description: "一种基于rpc的web框架协议和侵入式的agent实现？"
featured_image: "/static/images/语言无关的Web框架的构思/fox.jpeg"
categories: ["基础架构"]
tags: []
---

## 前言

随着互联网的迅速发展，基于Http的Web服务也变得非常普及。每一种图灵完备的编程语言，如果不支持开发Web服务，都会显得格格不入。

但是每一种编程语言的Web生态的成熟度都是不一样的，最成熟的应该是Java语言的Spring全家桶，其次是PHP的Laravel，Pyhton的Django，Ruby的Ruby on Rails，还有Go的Beego，Rust的Actix-web等等。

这些Web框架其实解决的问题都大同小异，就是方便程序员进行业务的开发和迭代，规范化业务逻辑，比如比较主流MVC模式，还有封装了很多组件，比如数据库、日志、缓存等等。

除了上述这些功能，还有封装了很多常用的性能优化手段，比如数据库连接池、Redis连接池，和消息队列等等中间件。

而且大部分上规模的互联网公司，都会选择微服务的架构来解耦他们的项目，但是微服务化也带来了许多问题和挑战，所以诞生了服务治理的概念。目前比较传统的是仅限于Java语言的Spring Cloud框架，和比较新颖的无侵入式的Service Mesh架构（可以参考我这一篇文章：[微服务治理生态的个人总结](/posts/微服务治理生态的个人总结/)）。

Service Mesh的目的是解决传统微服务治理架构和编程语言强耦合的问题，当然还有其他一些用途，但是无侵入式难度还是较大的，面对复杂的Web应用，很容易引入不确定性。比如`Istio`不支持Http 1.0，但是PHP的`file_get_contents`函数获取http链接内容时就是用的Http 1.0协议。

面对上述的这么多的共同目标：快速开发迭代、规范化、封装组件和中间件、服务治理等等，我想到了抽象和中间层。有一句名言是：`计算机科学领域的任何问题都可以通过增加一个间接的中间层来解决`，于是我就有了一种语言无关的Web框架的构思。

## 构思

首先先定几个小目标：

1. 语言无关的API。
1. 性能必须强大。
1. 可扩展性好。

第一点，既然是语言无关，那参考和复用目前的技术生态，很容易想到Grpc和Thrift等跨语言的Rpc框架。

第二点，对于中间层来说，对性能有损耗那是无法避免的事情，但需要尽量保证性能，所以选择Rust来开发（刚好我是Rust粉丝:)）。

第三点，可扩展性还是很重要的，因为不知道Web项目有什么特定的需求。如果没有可扩展性，那么就很容易被别人Fork然后二次开发、另起炉灶，导致生态的分裂。这里想到的是用加载动态链接库的方式。

## 初步的想法架构

我这里先给这个Web框架起名叫做`Olha`，名字来源于我挺喜欢的伊苏6女主角。

先开个Organization占一下坑：[olha-framework](https://github.com/olha-framework)。

简单的架构图如下：

![架构图](https://upload-images.jianshu.io/upload_images/18494435-7a6a6d499e97154f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

可以看出，`Olha agent`是以sidecar的形式存在的，它是一个大而全的东西，基本将上述谈到的Web服务中需要的共同功能都囊括了，开发的应用只要专注于实现业务逻辑就可以了。

①，应用协议，先使用Grpc作为Api设计的规范，成熟之后可以添加Thrift、Hprose等，甚至是基于进程共享内存等更快的方式。

②，网络协议，因为考虑到在本机器上的进程互相调用，Linux的话UDS协议会更快，对于Windows也可以选择TCP，这也是Grpc的需要。

## 后话

不知道开源界有没有同样想法的项目，即使有，我也会抽时间实现这个它。:)
